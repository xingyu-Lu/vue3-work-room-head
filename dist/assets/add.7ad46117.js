var Y=Object.defineProperty,Z=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var I=(t,l,m)=>l in t?Y(t,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):t[l]=m,x=(t,l)=>{for(var m in l||(l={}))ee.call(l,m)&&I(t,m,l[m]);if(O)for(var m of O(l))te.call(l,m)&&I(t,m,l[m]);return t},M=(t,l)=>Z(t,$(l));import{ad as oe,ao as le,r as V,al as ae,u as ne,a as re,ap as se,ak as f,o as ie,aq as de,t as me,c as n,d as g,ae as F,f as o,w as a,af as H,h as C,ah as L,g as T,ag as ue,e as ce,i as p}from"./vendor.0774305f.js";import{a as D,B as fe,E as _e,T as pe}from"./index.esm.1d203652.js";import{a as y}from"./axios.e8c7a5a3.js";import{_ as ge,l as j,u as q,d as he}from"./index.b35828bc.js";function be(t,l){const{link:m="",fileName:i=""}=t;return`<a data-w-e-type="attachment" data-w-e-is-void data-w-e-is-inline data-link="${m}" data-fileName="${i}" href="${m}" target="_blank">${i}</a>`}const Fe={type:"attachment",elemToHtml:be};D.elemsToHtml=[Fe];fe.registerModule(D);const ye={name:"news_add",components:{Plus:oe,Delete:le,Editor:_e,Toolbar:pe},setup(){V(null);const t=V(null),l=V(null),m=ae(),i=ne(),{id:_,office_id:w}=m.query,r=re({res_data:"",token:"Bearer "+j("token")||"",id:_,select_flag:!1,Form:{img_url:"",img:"",column_id:"",title:"",content:"",release_time:V(""),sort:"0",status:"0",disabled:!0,fileList:[],column_list:[]},rules:{column_id:[{required:!0,message:"\u680F\u76EE\u5FC5\u987B",trigger:["change"]}],title:[{required:!0,message:"\u6807\u9898\u5FC5\u987B",trigger:["change"]}],release_time:[{required:!0,message:"\u53D1\u5E03\u65F6\u95F4\u5FC5\u987B",trigger:["change"]}],sort:[{required:!1,message:"\u6392\u5E8F\u5FC5\u987B",trigger:["change"]}],status:[{required:!0,message:"\u72B6\u6001\u5FC5\u987B",trigger:["change"]}]}}),h=se(),b={insertKeys:{index:31,keys:["uploadAttachment"]}},E={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",hoverbarKeys:{attachment:{menuKeys:["downloadAttachment"]}},MENU_CONF:{uploadImage:{server:q,fieldName:"file",maxFileSize:2*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],meta:{basket:"img"},headers:{Authorization:r.token},customInsert:function(e,s){s(e.data.src,e.data.file_name,e.data.src)},onError(e,s,u){f.error(new Error(s).message),console.log(e,s,u)}},uploadVideo:{server:q,fieldName:"file",maxFileSize:100*1024*1024,allowedFileTypes:["video/*"],meta:{basket:"video"},headers:{Authorization:r.token},customInsert:function(e,s){s(e.data.src)},onError(e,s,u){f.error(new Error(s).message),console.log(e,s,u)}},uploadAttachment:{server:q,fieldName:"file",maxFileSize:10*1024*1024,meta:{basket:"attachment"},headers:{Authorization:r.token},customInsert:function(e,s,u){u(`${s.name}`,e.data.src)},onError(e,s,u){f.error(new Error(s).message),console.log(e,s,u)}}}},z=e=>{h.value=e};ie(()=>{R(),_&&y.get(`/api/head/technicalOfficeColumns/${_}`).then(e=>{r.Form={img_url:e.data.url||"",img:e.data.file_id,column_id:e.data.column_id,title:e.data.title,content:e.data.content,release_time:e.data.release_time,sort:e.data.sort,status:String(e.data.status),fileList:[{url:e.data.url}],disabled:!0},r.select_flag=!0}),j("userinfo")?r.res_data=j("userinfo"):U()}),de(()=>{const e=h.value;e!=null&&e.destroy()});const U=()=>{y.get("/api/head/staffs/info").then(e=>{r.res_data=e.data,localSet("userinfo",e.data)})},R=()=>{y.get("/api/head/technicalOfficeColumnSets/column_list").then(e=>{r.Form.column_list=e.data})},S=()=>{t.value.validate(e=>{if(e){let s=y.post,u={img:r.Form.img,column_id:r.Form.column_id,title:r.Form.title,content:r.Form.content,release_time:r.Form.release_time,sort:r.Form.sort,status:r.Form.status},k="/api/head/technicalOfficeColumns";_&&(u.release_time=r.Form.release_time,s=y.put,k=`/api/head/technicalOfficeColumns/${_}`),s(k,u).then(()=>{_?f.success("\u4FEE\u6539\u6210\u529F"):f.success("\u6DFB\u52A0\u6210\u529F"),i.push({path:"/kssz-column-index",query:{id:w}})})}})},N=e=>{if((e.size/1024/1024).toFixed(2)>1)return f.error("\u4E0A\u4F20\u7684\u56FE\u7247\u5927\u4E8E1\u5146"),!1;const u=e.name.split(".")[1]||"";if(!["jpg","jpeg","png","gif"].includes(u))return f.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png\u3001gif \u683C\u5F0F\u7684\u56FE\u7247"),!1},c=e=>{f.success("\u4E0A\u4F20\u6210\u529F"),r.Form.img_url=e.data.src||"",r.Form.img=e.data.id||""},B=e=>{f.error("\u4E0A\u4F20\u5931\u8D25")},v=e=>{l.value.clearFiles(),r.Form.img=""};return M(x({},me(r)),{editorRef:h,mode:"default",toolbarConfig:b,editorConfig:E,handleCreated:z,uploadRef:l,Ref:t,submitAdd:S,uploadImgServer:he,handleBeforeUpload:N,handleUrlSuccess:c,handleUrlError:B,handleRemove:v,office_id:w})}},ve={style:{float:"right",height:"150px","align-items":"center",display:"flex","font-size":"36px","letter-spacing":"0.2em",color:"#fff"}},ke={key:0},Ve=p("\u4E09\u6C5F\u540D\u533B\u5DE5\u4F5C\u5BA4"),Ce=p("\u90E8\u95E8\u8BBE\u7F6E"),we=p("\u90E8\u95E8\u680F\u76EE"),Ee=p("\u680F\u76EE\u7C7B\u578B\u4E3A\u4EC5\u56FE\uFF1A\u5219\u5FC5\u987B\u4F20\u56FE\u7247\uFF1B\u680F\u76EE\u7C7B\u578B\u4E3A\u56FE\u6587\u6216\u89C6\u9891\uFF1A\u5219\u5185\u5BB9\u5FC5\u987B\uFF1B\u6392\u5E8F\u53EA\u5BF9\u4EC5\u56FE\u7684\u6709\u6548(\u6570\u5B57\u8D8A\u5C0F\u8D8A\u9760\u524D)"),ze=["src"],Ue={class:"el-upload-list__item-actions"},Re={style:{border:"1px solid #ccc","z-index":"100"}},Se=p("\u5DF2\u5BA1\u6838"),Ne=p("\u5F85\u5BA1\u6838");function Be(t,l,m,i,_,w){const r=n("el-col"),h=n("el-row"),b=n("el-breadcrumb-item"),E=n("el-breadcrumb"),z=n("el-descriptions-item"),U=n("el-descriptions"),R=n("el-divider"),S=n("el-option"),N=n("el-select"),c=n("el-form-item"),B=n("plus"),v=n("el-icon"),e=n("delete"),s=n("el-upload"),u=n("el-input"),k=n("Toolbar"),K=n("Editor"),G=n("el-date-picker"),A=n("el-radio"),P=n("el-radio-group"),J=n("el-button"),Q=n("el-form"),W=n("el-card");return g(),F(H,null,[o(h,{justify:"center",align:"middle",style:{background:"linear-gradient(135deg, rgb(36 205 103 / 95%) 0%, rgb(56 150 226 / 95%) 100% )","margin-bottom":"20px","margin-top":"-10px"}},{default:a(()=>[o(r,{span:24},{default:a(()=>[C("div",ve,[t.res_data.office?(g(),F("strong",ke,L(t.res_data.office.office_name),1)):T("",!0)])]),_:1})]),_:1}),o(E,{separator:"/",style:{"margin-bottom":"20px"}},{default:a(()=>[o(b,{to:{path:"/"}},{default:a(()=>[Ve]),_:1}),o(b,{to:{path:"/kssz",query:{id:i.office_id}}},{default:a(()=>[Ce]),_:1},8,["to"]),o(b,null,{default:a(()=>[we]),_:1})]),_:1}),o(W,{style:{"min-height":"100%"}},{default:a(()=>[o(U,{title:"\u63D0\u793A"},{default:a(()=>[o(z,null,{default:a(()=>[Ee]),_:1})]),_:1}),o(R),o(Q,{model:t.Form,rules:t.rules,ref:"Ref","label-width":"100px"},{default:a(()=>[o(c,{label:"\u680F\u76EE",prop:"column_id"},{default:a(()=>[o(N,{modelValue:t.Form.column_id,"onUpdate:modelValue":l[0]||(l[0]=d=>t.Form.column_id=d),placeholder:"Select",filterable:""},{default:a(()=>[(g(!0),F(H,null,ue(t.Form.column_list,d=>(g(),ce(S,{key:d.id,label:d.name+d.type_name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(c,{label:"\u56FE\u7247",prop:"img"},{default:a(()=>[o(s,{ref:"uploadRef",action:i.uploadImgServer,data:{basket:"img"},limit:1,"list-type":"picture-card","thumbnail-mode":"true",headers:{Authorization:t.token},"before-upload":i.handleBeforeUpload,"on-success":i.handleUrlSuccess,"on-error":i.handleUrlError,"auto-upload":!0,"file-list":t.Form.fileList},{default:a(()=>[o(v,null,{default:a(()=>[o(B)]),_:1})]),file:a(({file:d})=>[C("div",null,[t.Form.img_url?(g(),F("img",{key:0,class:"el-upload-list__item-thumbnail",src:t.Form.img_url,alt:""},null,8,ze)):T("",!0),C("span",Ue,[t.Form.disabled?(g(),F("span",{key:0,class:"el-upload-list__item-delete",onClick:l[1]||(l[1]=(...X)=>i.handleRemove&&i.handleRemove(...X))},[o(v,null,{default:a(()=>[o(e)]),_:1})])):T("",!0)])])]),_:1},8,["action","headers","before-upload","on-success","on-error","file-list"])]),_:1}),o(c,{label:"\u6807\u9898",prop:"title"},{default:a(()=>[o(u,{modelValue:t.Form.title,"onUpdate:modelValue":l[2]||(l[2]=d=>t.Form.title=d),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",type:"text"},null,8,["modelValue"])]),_:1}),o(c,{label:"\u5185\u5BB9",prop:"content"},{default:a(()=>[C("div",Re,[o(k,{style:{"border-bottom":"1px solid #ccc"},editor:i.editorRef,defaultConfig:i.toolbarConfig,mode:i.mode},null,8,["editor","defaultConfig","mode"]),o(K,{style:{height:"500px","overflow-y":"hidden"},modelValue:t.Form.content,"onUpdate:modelValue":l[3]||(l[3]=d=>t.Form.content=d),defaultConfig:i.editorConfig,mode:i.mode,onOnCreated:i.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),o(c,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"release_time"},{default:a(()=>[o(G,{modelValue:t.Form.release_time,"onUpdate:modelValue":l[4]||(l[4]=d=>t.Form.release_time=d),type:"datetime","default-value":new Date,placeholder:"\u8BF7\u8F93\u5165\u53D1\u5E03\u65F6\u95F4"},null,8,["modelValue","default-value"])]),_:1}),o(c,{label:"\u6392\u5E8F",prop:"sort"},{default:a(()=>[o(u,{modelValue:t.Form.sort,"onUpdate:modelValue":l[5]||(l[5]=d=>t.Form.sort=d),placeholder:"\u8BF7\u8F93\u5165\u6392\u5E8F",type:"number"},null,8,["modelValue"])]),_:1}),o(c,{label:"\u72B6\u6001",prop:"status"},{default:a(()=>[o(P,{modelValue:t.Form.status,"onUpdate:modelValue":l[6]||(l[6]=d=>t.Form.status=d),disabled:""},{default:a(()=>[o(A,{label:"1"},{default:a(()=>[Se]),_:1}),o(A,{label:"0"},{default:a(()=>[Ne]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(c,null,{default:a(()=>[o(J,{type:"primary",onClick:l[7]||(l[7]=d=>i.submitAdd())},{default:a(()=>[p(L(t.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})],64)}var Ie=ge(ye,[["render",Be]]);export{Ie as default};

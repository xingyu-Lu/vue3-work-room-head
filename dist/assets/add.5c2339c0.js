var G=Object.defineProperty,P=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var B=(t,o,d)=>o in t?G(t,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[o]=d,q=(t,o)=>{for(var d in o||(o={}))Q.call(o,d)&&B(t,d,o[d]);if(A)for(var d of A(o))W.call(o,d)&&B(t,d,o[d]);return t},O=(t,o)=>P(t,J(o));import{ad as X,ao as Y,r as y,al as Z,u as $,a as ee,ap as te,ak as c,o as oe,aq as ae,t as le,c as i,d as v,ae as k,f as a,w as l,af as re,h as w,ah as I,g as S,i as p}from"./vendor.0774305f.js";import{a as D,B as ne,E as se,T as ie}from"./index.esm.1d203652.js";import{a as C}from"./axios.e8c7a5a3.js";import{_ as de,l as T,u as j,d as me}from"./index.b35828bc.js";function ue(t,o){const{link:d="",fileName:s=""}=t;return`<a data-w-e-type="attachment" data-w-e-is-void data-w-e-is-inline data-link="${d}" data-fileName="${s}" href="${d}" target="_blank">${s}</a>`}const ce={type:"attachment",elemToHtml:ue};D.elemsToHtml=[ce];ne.registerModule(D);const fe={name:"news_add",components:{Plus:X,Delete:Y,Editor:se,Toolbar:ie},setup(){y(null);const t=y(null),o=y(null),d=Z(),s=$(),{id:_,office_id:V}=d.query,r=ee({res_data:"",token:"Bearer "+T("token")||"",id:_,select_flag:!1,Form:{img_url:"",img:"",title:"",content:"",release_time:y(""),status:"0",disabled:!0,fileList:[]},rules:{img:[{required:!0,message:"\u56FE\u7247\u5FC5\u987B",trigger:["change"]}],title:[{required:"true",message:"\u6807\u9898",trigger:["change"]}],release_time:[{required:"true",message:"\u53D1\u5E03\u65F6\u95F4\u5FC5\u987B",trigger:["change"]}],status:[{required:!1,message:"\u72B6\u6001\u5FC5\u987B",trigger:["change"]}]}}),g=te(),h={insertKeys:{index:31,keys:["uploadAttachment"]}},E={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",hoverbarKeys:{attachment:{menuKeys:["downloadAttachment"]}},MENU_CONF:{uploadImage:{server:j,fieldName:"file",maxFileSize:2*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],meta:{basket:"img"},headers:{Authorization:r.token},customInsert:function(e,n){n(e.data.src,e.data.file_name,e.data.src)},onError(e,n,m){c.error(new Error(n).message),console.log(e,n,m)}},uploadVideo:{server:j,fieldName:"file",maxFileSize:100*1024*1024,allowedFileTypes:["video/*"],meta:{basket:"video"},headers:{Authorization:r.token},customInsert:function(e,n){n(e.data.src)},onError(e,n,m){c.error(new Error(n).message),console.log(e,n,m)}},uploadAttachment:{server:j,fieldName:"file",maxFileSize:10*1024*1024,meta:{basket:"attachment"},headers:{Authorization:r.token},customInsert:function(e,n,m){m(`${n.name}`,e.data.src)},onError(e,n,m){c.error(new Error(n).message),console.log(e,n,m)}}}},z=e=>{g.value=e};oe(()=>{_&&C.get(`/api/head/technicalOfficeDynamics/${_}`).then(e=>{r.Form={img_url:e.data.url||"",img:e.data.file_id,title:e.data.title,release_time:e.data.release_time,status:String(e.data.status),content:e.data.content,fileList:[{url:e.data.url}],disabled:!0},r.select_flag=!0}),T("userinfo")?r.res_data=T("userinfo"):b()}),ae(()=>{const e=g.value;e!=null&&e.destroy()});const b=()=>{C.get("/api/head/staffs/info").then(e=>{r.res_data=e.data,localSet("userinfo",e.data)})},R=()=>{t.value.validate(e=>{if(e){let n=C.post,m={img:r.Form.img,title:r.Form.title,content:r.Form.content,release_time:r.Form.release_time,status:r.Form.status},F="/api/head/technicalOfficeDynamics";_&&(m.release_time=r.Form.release_time,n=C.put,F=`/api/head/technicalOfficeDynamics/${_}`),n(F,m).then(()=>{_?c.success("\u4FEE\u6539\u6210\u529F"):c.success("\u6DFB\u52A0\u6210\u529F"),s.push({path:"/kssz-ksdt-index",query:{id:V}})})}})},N=e=>{if((e.size/1024/1024).toFixed(2)>1)return c.error("\u4E0A\u4F20\u7684\u56FE\u7247\u5927\u4E8E1\u5146"),!1;const m=e.name.split(".")[1]||"";if(!["jpg","jpeg","png","gif"].includes(m))return c.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png\u3001gif \u683C\u5F0F\u7684\u56FE\u7247"),!1},f=e=>{c.success("\u4E0A\u4F20\u6210\u529F"),r.Form.img_url=e.data.src||"",r.Form.img=e.data.id||""},U=e=>{c.error("\u4E0A\u4F20\u5931\u8D25")},x=e=>{o.value.clearFiles(),r.Form.img="",r.Form.fileList=[]};return O(q({},le(r)),{editorRef:g,mode:"default",toolbarConfig:h,editorConfig:E,handleCreated:z,uploadRef:o,Ref:t,submitAdd:R,uploadImgServer:me,handleBeforeUpload:N,handleUrlSuccess:f,handleUrlError:U,handleRemove:x,office_id:V})}},_e={style:{float:"right",height:"150px","align-items":"center",display:"flex","font-size":"36px","letter-spacing":"0.2em",color:"#fff"}},pe={key:0},ge=p("\u4E09\u6C5F\u540D\u533B\u5DE5\u4F5C\u5BA4"),he=p("\u90E8\u95E8\u8BBE\u7F6E"),be=p("\u90E8\u95E8\u52A8\u6001"),Fe=["src"],ye={class:"el-upload-list__item-actions"},ve={style:{border:"1px solid #ccc","z-index":"100"}},ke=p("\u5DF2\u5BA1\u6838"),we=p("\u5F85\u5BA1\u6838");function Ce(t,o,d,s,_,V){const r=i("el-col"),g=i("el-row"),h=i("el-breadcrumb-item"),E=i("el-breadcrumb"),z=i("plus"),b=i("el-icon"),R=i("delete"),N=i("el-upload"),f=i("el-form-item"),U=i("el-input"),x=i("Toolbar"),e=i("Editor"),n=i("el-date-picker"),m=i("el-radio"),F=i("el-radio-group"),M=i("el-button"),H=i("el-form"),L=i("el-card");return v(),k(re,null,[a(g,{justify:"center",align:"middle",style:{background:"linear-gradient(135deg, rgb(36 205 103 / 95%) 0%, rgb(56 150 226 / 95%) 100% )","margin-bottom":"20px","margin-top":"-10px"}},{default:l(()=>[a(r,{span:24},{default:l(()=>[w("div",_e,[t.res_data.office?(v(),k("strong",pe,I(t.res_data.office.office_name),1)):S("",!0)])]),_:1})]),_:1}),a(E,{separator:"/",style:{"margin-bottom":"20px"}},{default:l(()=>[a(h,{to:{path:"/"}},{default:l(()=>[ge]),_:1}),a(h,{to:{path:"/kssz",query:{id:s.office_id}}},{default:l(()=>[he]),_:1},8,["to"]),a(h,null,{default:l(()=>[be]),_:1})]),_:1}),a(L,{style:{"min-height":"100%"}},{default:l(()=>[a(H,{model:t.Form,rules:t.rules,ref:"Ref","label-width":"100px"},{default:l(()=>[a(f,{label:"\u5C01\u9762\u56FE",prop:"img"},{default:l(()=>[a(N,{ref:"uploadRef",action:s.uploadImgServer,data:{basket:"img"},limit:1,"list-type":"picture-card","thumbnail-mode":"true",headers:{Authorization:t.token},"before-upload":s.handleBeforeUpload,"on-success":s.handleUrlSuccess,"on-error":s.handleUrlError,"auto-upload":!0,"file-list":t.Form.fileList},{default:l(()=>[a(b,null,{default:l(()=>[a(z)]),_:1})]),file:l(({file:u})=>[w("div",null,[t.Form.img_url?(v(),k("img",{key:0,class:"el-upload-list__item-thumbnail",src:t.Form.img_url,alt:""},null,8,Fe)):S("",!0),w("span",ye,[t.Form.disabled?(v(),k("span",{key:0,class:"el-upload-list__item-delete",onClick:o[0]||(o[0]=(...K)=>s.handleRemove&&s.handleRemove(...K))},[a(b,null,{default:l(()=>[a(R)]),_:1})])):S("",!0)])])]),_:1},8,["action","headers","before-upload","on-success","on-error","file-list"])]),_:1}),a(f,{label:"\u6807\u9898",prop:"title"},{default:l(()=>[a(U,{modelValue:t.Form.title,"onUpdate:modelValue":o[1]||(o[1]=u=>t.Form.title=u),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",type:"text"},null,8,["modelValue"])]),_:1}),a(f,{label:"\u5185\u5BB9",prop:"content"},{default:l(()=>[w("div",ve,[a(x,{style:{"border-bottom":"1px solid #ccc"},editor:s.editorRef,defaultConfig:s.toolbarConfig,mode:s.mode},null,8,["editor","defaultConfig","mode"]),a(e,{style:{height:"500px","overflow-y":"hidden"},modelValue:t.Form.content,"onUpdate:modelValue":o[2]||(o[2]=u=>t.Form.content=u),defaultConfig:s.editorConfig,mode:s.mode,onOnCreated:s.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),a(f,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"release_time"},{default:l(()=>[a(n,{modelValue:t.Form.release_time,"onUpdate:modelValue":o[3]||(o[3]=u=>t.Form.release_time=u),type:"datetime","default-value":new Date,placeholder:"\u8BF7\u8F93\u5165\u53D1\u5E03\u65F6\u95F4"},null,8,["modelValue","default-value"])]),_:1}),a(f,{label:"\u72B6\u6001",prop:"status"},{default:l(()=>[a(F,{modelValue:t.Form.status,"onUpdate:modelValue":o[4]||(o[4]=u=>t.Form.status=u),disabled:""},{default:l(()=>[a(m,{label:"1"},{default:l(()=>[ke]),_:1}),a(m,{label:"0"},{default:l(()=>[we]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(f,null,{default:l(()=>[a(M,{type:"primary",onClick:o[5]||(o[5]=u=>s.submitAdd())},{default:l(()=>[p(I(t.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})],64)}var Ue=de(fe,[["render",Ce]]);export{Ue as default};
